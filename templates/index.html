<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>New Haven HangOut</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/landing.css') }}">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
</head>

<body>
    <!-- Landing Page Overlay -->
    <div id="landing-overlay">
        <div id="landing-aura">
            <div class="aura-blob blob-1"></div>
            <div class="aura-blob blob-2"></div>
            <div class="aura-blob blob-3"></div>
        </div>

        <div id="landing-swiper">
            <!-- Slide 1: Welcome -->
            <div class="landing-slide">
                <div class="slide-content">
                    <h1>New Haven Hangouts</h1>
                    <p>Stop scrolling, start hanging. Connect with your friends in the real world.</p>
                </div>
            </div>

            <!-- Slide 2: Favorite Spots -->
            <div class="landing-slide">
                <div class="slide-content">
                    <h2>Favorite Spots</h2>
                    <p>Check-in at your favorite haunts and let friends know where you are.</p>
                </div>
            </div>

            <!-- Slide 3: Signal -->
            <div class="landing-slide">
                <div class="slide-content">
                    <h2>Down to Hang?</h2>
                    <p>Signal to your crew that you're available for a catch-up.</p>
                </div>
            </div>

            <!-- Slide 4: CTA -->
            <div class="landing-slide">
                <div class="slide-content">
                    <h2>Ready to Check-In?</h2>
                    <p>Your friends are waiting!</p>
                    <button id="get-started-btn" class="cta-button">Get Started</button>
                </div>
            </div>
        </div>

        <div id="landing-pagination">
            <div class="dot active"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <!-- FAB Navigation -->
        <div class="fab-container">
            <div class="fab-menu" id="fabMenu">
                <div class="menu-user">
                    <div class="user-avatar">üë§</div>
                    <span id="usernameDisplay">Guest</span>
                </div>
                <div class="menu-items">
                    <button onclick="toggleTheme()" class="menu-item" id="themeToggleBtn">
                        üèîÔ∏è Glacier Mode
                    </button>
                    <a href="/friends" class="menu-item">
                        üë• Friends
                    </a>
                    <a href="/stats" class="menu-item">
                        üìä Stats
                    </a>
                    <a href="/about" class="menu-item">
                        ‚ÑπÔ∏è About
                    </a>
                    <a href="/child-safety" class="menu-item">
                        üõ°Ô∏è Report Issue
                    </a>
                    <button onclick="logout()" class="menu-item item-logout">
                        üö™ Log Out
                    </button>
                    <button onclick="deleteAccount()" class="menu-item item-delete-account"
                        style="color: #ff4d4d; border-top: 1px solid rgba(255, 77, 77, 0.2); margin-top: 0.5rem; padding-top: 1rem;">
                        üóëÔ∏è Delete Account
                    </button>
                </div>
            </div>
            <button class="fab-main" onclick="toggleFabMenu()">
                <span class="fab-icon">‚ò∞</span>
            </button>
        </div>

        <!-- Login Modal -->
        <div class="modal" id="loginModal">
            <div class="modal-content">
                <h2 id="modalTitle">Welcome!</h2>
                <div class="auth-tabs">
                    <button class="auth-tab active" id="loginTab" onclick="switchAuthMode('login')">Login</button>
                    <button class="auth-tab" id="signupTab" onclick="switchAuthMode('signup')">Sign Up</button>
                </div>

                <!-- Login Form -->
                <div id="loginForm" class="auth-form">
                    <input type="email" id="loginEmail" placeholder="Email" />
                    <div class="password-input-container">
                        <input type="password" id="loginPassword" placeholder="Password" />
                        <button type="button" class="password-toggle"
                            onclick="togglePasswordVisibility('loginPassword', this)">
                            <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                                </path>
                                <line x1="1" y1="1" x2="23" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                    <label class="remember-me">
                        <span>Remember Me</span>
                        <input type="checkbox" id="rememberMe">
                    </label>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="performLogin()">Login</button>
                        <a href="#" class="forgot-password" onclick="showForgotPassword()">Forgot Password?</a>
                    </div>
                </div>

                <!-- Forgot Password Form -->
                <div id="forgotPasswordForm" class="auth-form" style="display: none;">
                    <p style="margin-bottom: 1rem; color: var(--text-secondary);">Enter your email to receive a reset
                        link.</p>
                    <input type="email" id="forgotEmail" placeholder="Email" />
                    <button class="btn btn-primary" onclick="requestPasswordReset()">Send Link</button>
                    <button class="btn btn-text" onclick="switchAuthMode('login')">Back to Login</button>
                </div>

                <!-- Signup Form -->
                <div id="signupForm" class="auth-form" style="display: none;">
                    <input type="text" id="signupUsername" placeholder="Username" />
                    <input type="email" id="signupEmail" placeholder="Email" />
                    <div class="password-input-container">
                        <input type="password" id="signupPassword" placeholder="Password" />
                        <button type="button" class="password-toggle"
                            onclick="togglePasswordVisibility('signupPassword', this)">
                            <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                                </path>
                                <line x1="1" y1="1" x2="23" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="password-input-container">
                        <input type="password" id="signupConfirmPassword" placeholder="Confirm Password" />
                        <button type="button" class="password-toggle"
                            onclick="togglePasswordVisibility('signupConfirmPassword', this)">
                            <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                                </path>
                                <line x1="1" y1="1" x2="23" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                    <button class="btn btn-primary" onclick="performSignup()">Sign Up</button>
                </div>

                <div id="authMessage" class="auth-message"></div>
            </div>
        </div>

        <!-- Location Disclosure Modal -->
        <div class="modal" id="locationDisclosureModal">
            <div class="modal-content disclosure-content">
                <h2>Location Access</h2>
                <div class="disclosure-body">
                    <p>To help you connect with friends, <strong>HangApp</strong> requires access to your precise
                        location.</p>
                    <div class="disclosure-item">
                        <span class="disclosure-icon">üìç</span>
                        <div class="disclosure-text">
                            <strong>Check-ins:</strong> Your location is only accessed when you check in to select your
                            venue.
                        </div>
                    </div>
                    <div class="disclosure-item">
                        <span class="disclosure-icon">üë•</span>
                        <div class="disclosure-text">
                            <strong>Sharing:</strong> Shared <strong>only</strong> with confirmed friends.
                        </div>
                    </div>
                    <div class="disclosure-item">
                        <span class="disclosure-icon">üîí</span>
                        <div class="disclosure-text">
                            <strong>Privacy:</strong> No background tracking. Only accessed while using the app.
                        </div>
                    </div>
                </div>
                <div class="disclosure-actions">
                    <button class="btn btn-primary" onclick="acceptLocationDisclosure()">I Understand</button>
                    <button class="btn btn-text" onclick="closeLocationDisclosure()">Not Now</button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- View Toggle -->
            <div class="view-toggle">
                <button class="toggle-btn active" id="mapViewBtn" onclick="switchView('map')">
                    üó∫Ô∏è Map
                </button>
                <button class="toggle-btn" id="listViewBtn" onclick="switchView('list')">
                    üìã List
                </button>
            </div>

            <!-- Map Container -->
            <div id="mapView" class="view-container">
                <div id="map"></div>
            </div>

            <!-- List Container -->
            <div id="listView" class="view-container" style="display: none;">
                <div class="list-content">
                    <h2>Friends' Check-ins</h2>
                    <div id="checkinsList"></div>
                </div>
            </div>

            <!-- Controls Overlay -->
            <div class="controls-overlay">
                <button class="btn btn-checkin" id="checkinBtn" onclick="showCheckinForm()">
                    üìç Check In
                </button>
                <button class="btn btn-refresh" onclick="loadFeed()">
                    üîÑ Refresh
                </button>
            </div>

            <!-- Check-in Form -->
            <div class="checkin-form" id="checkinForm" style="display: none;">
                <div class="form-header">
                    <h3>Create Check-In</h3>
                    <button class="btn-close" onclick="hideCheckinForm()">‚úï</button>
                </div>
                <div class="form-body">
                    <label for="locationSearch">Search for a location</label>
                    <div class="search-container">
                        <input type="text" id="locationSearch" placeholder="Search for a place (e.g., Koffee)"
                            oninput="searchLocation(this.value)" onkeyup="searchLocation(this.value)"
                            autocomplete="off" />
                        <div id="searchResults" class="search-results"></div>
                    </div>
                    <div class="or-divider">
                        <span>OR</span>
                    </div>
                    <button class="btn btn-secondary" id="useCurrentLocationBtn" onclick="useCurrentLocation()">
                        üìç Use My Current Location
                    </button>
                    <input type="text" id="locationName" placeholder="Location name" readonly />
                    <input type="hidden" id="selectedLat" />
                    <input type="hidden" id="selectedLng" />
                    <textarea id="message" placeholder="What are you up to? (optional)" rows="3"></textarea>
                    <label for="duration">How long will you be here?</label>
                    <select id="duration">
                        <option value="30">30 minutes</option>
                        <option value="60" selected>1 hour</option>
                        <option value="90">1.5 hours</option>
                        <option value="120">2 hours</option>
                        <option value="180">3 hours</option>
                        <option value="180">3 hours</option>
                    </select>

                    <!-- Friend Selection -->
                    <div class="friend-selection-section">
                        <label>Share with:</label>
                        <div class="visibility-options">
                            <label class="radio-label">
                                <input type="radio" name="visibility" value="everyone" checked
                                    onchange="toggleFriendList(false)">
                                Everyone (All Friends)
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="visibility" value="specific"
                                    onchange="toggleFriendList(true)">
                                Specific Friends
                            </label>
                        </div>

                        <div id="friendSelectionList" class="friend-list-container" style="display: none;">
                            <div class="select-all-container">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="selectAllFriends"
                                        onchange="toggleSelectAllFriends(this)">
                                    Select All
                                </label>
                            </div>
                            <div id="friendsCheckboxes">
                                <!-- Populated via JS -->
                                <p class="loading-text">Loading friends...</p>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="submitCheckin()">Post Check-In</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/landing.js') }}"></script>
</body>

</html>